<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>修改酒店信息</title>
    <script
    src="https://code.jquerfy.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<!-- 对话框  -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/js/bootstrap-dialog.min.js"></script>
   
   </head>

<style>

    #main{
        margin-top: 20px;
    }

    #panel{
        width: 600px;
        /* 使得面板居中的Css */
        margin: auto;
        position: absolute;
        left: 0;
        right: 0;

    }

    .hbtn{
        text-align: right;
    }
</style>


<body>
    <div id="main">
        <div class="panel panel-default" id="panel">
            <div class="panel-heading">
                <h3 class="panel-title">修改订单</h3>
            </div>
            <div class="panel-body">

           <!-- 请求方式 如：edit_hotel.html?id=123  -->


            <form action="" method="" >

                <div class="form-area form-group" >
                    <div>
                        <span>订单id</span>
                        <input type="text" name="id" id="id" class="form-control" readonly>
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>订单号</span>
                        <input type="text" name="order_number" id="order_number" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>入店时间</span>
                        <input type="text" name="start_time" id="start_time" class="form-control">
                    </div>
                </div>


                 <div class="form-area form-group" >
                    <div>
                        <span>离店时间</span>
                        <input type="text" name="end_time" id="end_time" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>创建时间</span>
                        <input type="text" name="create_time" id="create_time" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>酒店ID</span>
                        <input type="text" name="hotel_id" id="hotel_id" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>售卖房型ID</span>
                        <input type="text" name="room_selling_id" id="room_selling_id" class="form-control">
                    </div>
                </div>

            
                <div class="form-area form-group" >
                    <div>
                        <span>入住人姓名</span>
                        <input type="text" name="name" id="name" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>手机号</span>
                        <input type="text" name="telephone" id="telephone" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>用户唯一标识</span>
                        <input type="text" name="openid" id="openid" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>订单状态</span>
                        <input type="text" name="order_state" id="order_state" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>押金</span>
                        <input type="text" name="deposit" id="deposit" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>应付金额</span>
                        <input type="text" name="payable" id="payable" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>实付金额</span>
                        <input type="text" name="payment" id="payment" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>退款理由</span>
                        <input type="text" name="refund_reason" id="refund_reason" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>拒绝退款理由</span>
                        <input type="text" name="refuse_refund_reason" id="refuse_refund_reason" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>退押金金额</span>
                        <input type="text" name="refund_deposit" id="refund_deposit" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>扣押金理由</span>
                        <input type="text" name="drefund_eposit_reason" id="drefund_eposit_reason" class="form-control">
                    </div>
                </div>

                <div class="form-area form-group" >
                    <div>
                        <span>申请退款时间</span>
                        <input type="text" name="refund_time" id="refund_time" class="form-control">
                    </div>
                </div>



            </form>
            </div>

            <div class="panel-footer">
                <div class="hbtn" >
                    <button class="btn btn-default" type="submit" onclick="go()">返回</button>

                    <button style="margin-left: 10px;" class="btn btn-danger"  onclick="dodelete()">删除</button>

                    <!-- 若使用ajax的方式进行提交 需要去掉type="submit"！！ -->
                    <button style="margin-left: 10px;" class="btn btn-primary"  onclick="doedit()">修改</button>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- 
    id  订单id
order_number 订单号
    start_time 入店时间
    end_time   离店时间
create_time 创建时间
     hotel_id  酒店ID
     room_selling_id 售卖房型ID
     name 入住人姓名
     telephone 手机号
openid  用户唯一标识
     order_state 订单状态
deposit 押金
payable 应付金额
payment 实付金额
refund_reason 退款理由
refuse_refund_reason 拒绝退款理由
refund_deposit 退押金金额
drefund_eposit_reason 扣押金理由
refund_time申请退款时间
 -->
<script>

    init();

    function go(){
        window.history.go(-1);
    }

    function getUrlParam(name) { //封装方法
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg); //匹配目标参数
        if(r != null) return unescape(r[2]);
        return null; //返回参数值
    }

    function init(){

        // 测试使用
        document.getElementById("id").value=getUrlParam("id");
        //从网址中获得携带的参数 id 
        let id = getUrlParam("id"); 
        $.ajax({
       	 url:'OrderServlet?cmd=find'+"&orderid="+id,
            method:'get',
           success:function(resp){
               //将从servlet中获得的数据 填写到网页的input表单中
				console.log("这是从Servlet中获取到的数据："+resp[0]);
				document.getElementById("order_number").value=resp[0].order_number;
				document.getElementById("start_time").value=resp[0].checkindate;
				document.getElementById("end_time").value=resp[0].checkoutdate;
				document.getElementById("create_time").value=resp[0].create_time;
				document.getElementById("hotel_id").value=resp[0].hotelid;
				document.getElementById("room_selling_id").value=resp[0].housestyleid;
				document.getElementById("name").value=resp[0].contactusername;
				document.getElementById("telephone").value=resp[0].phone;
				document.getElementById("openid").value=resp[0].openid;
				document.getElementById("order_state").value=resp[0].status;
				document.getElementById("deposit").value=resp[0].deposit;
				document.getElementById("payable").value=resp[0].payable;
				document.getElementById("payment").value=resp[0].payment;
				document.getElementById("refund_reason").value=resp[0].refund_reason;
				document.getElementById("refuse_refund_reason").value=resp[0].refuse_refund_reason;
				document.getElementById("refund_deposit").value=resp[0].refund_deposit;
				document.getElementById("drefund_eposit_reason").value=resp[0].drefund_eposit_reason;
				document.getElementById("refund_time").value=resp[0].refund_time;
           }       
       })
   }

    function doedit(){
        // 请在此处编写 自定义ajax提交逻辑
          let id = getUrlParam("id");
           $.ajax({ 	   
           url:"OrderServlet?cmd=edit&orderid="+id+"&order_number="+$("#order_number").val()+"&start_time="+$("#start_time").val()+"&end_time="+$("#end_time").val()+"&create_time="+$("#create_time").val()+"&hotel_id="+$("#hotel_id").val()+"&room_selling_id="+$("#room_selling_id").val()+"&name="+$("#name").val()+"&telephone="+$("#telephone").val()+"&openid="+$("#openid").val()+"&order_state="+$("#order_state").val()+"&deposit="+$("#deposit").val()+"&payable="+$("#payable").val()+"&payment="+$("#payment").val()+"&refund_reason="+$("#refund_reason").val()+"&refuse_refund_reason="+$("#refuse_refund_reason").val()+"&refund_deposit="+$("#refund_deposit").val()+"&drefund_eposit_reason="+$("#drefund_eposit_reason").val()+"&refund_time="+$("#refund_time").val(),
           method:'get',
           success:function(data) {
               if (data===true) {
               	window.location.href="order_manage.html"
               }else {
                   BootstrapDialog.show({
                       title:"提示",
                       message:"更新失败",
                       type:BootstrapDialog.TYPE_WARNING
                   })
               }
           },
           error: function () {

           },


           fail:function () {
               BootstrapDialog.show({
                   title:"提示",
                   message:"更新失败",
                   type:BootstrapDialog.TYPE_WARNING
               })
           }

       })
    }
    

  init();
</script>

</html>